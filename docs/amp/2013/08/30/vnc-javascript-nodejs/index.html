<!DOCTYPE html>
<html ⚡="" amp="">
  <head><meta charset="utf-8"><script async src="https://cdn.ampproject.org/v0.js"></script>
    
<meta name="pinterest" content="nopin">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="theme-color" content="#263238">

<meta name="generator" content="Hugo 0.22-DEV">

<link rel="apple-touch-icon" href="http://blog.mgechev.com/images/logo.png">


<link rel="canonical" href="http://blog.mgechev.com/2013/08/30/vnc-javascript-nodejs/">


    
    
    
    <title>VNC client on 200 lines of JavaScript - Minko Gechev&#39;s blog</title>
    <style amp-boilerplate="">body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate="">body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    
    
<meta name="description" content="In this quick blog post I’ll show you how to create a simple VNC client in about 200 lines of JavaScript. For our goal we’re going to use only HTML5 and JavaScript (client and server side). The end result will be something like this:So, let’s begin!Our application will have very simple architecture – a proxy server written in Node.js and a client in HTML5 and JavaScript. The Node.">

<meta property="og:title" content="VNC client on 200 lines of JavaScript - Minko Gechev&#39;s blog">
<meta property="og:type" content="article">
<meta property="og:url" content="http://blog.mgechev.com/2013/08/30/vnc-javascript-nodejs/">
<meta property="og:site_name" content="Minko Gechev&#39;s blog">
<meta property="og:description" content="In this quick blog post I’ll show you how to create a simple VNC client in about 200 lines of JavaScript. For our goal we’re going to use only HTML5 and JavaScript (client and server side). The end result will be something like this:So, let’s begin!Our application will have very simple architecture – a proxy server written in Node.js and a client in HTML5 and JavaScript. The Node.">
<meta property="og:locale" content="ja_JP">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="Minko Gechev&#39;s blog">
<meta name="twitter:url" content="http://blog.mgechev.com/2013/08/30/vnc-javascript-nodejs/">
<meta name="twitter:title" content="VNC client on 200 lines of JavaScript - Minko Gechev&#39;s blog">
<meta name="twitter:description" content="In this quick blog post I’ll show you how to create a simple VNC client in about 200 lines of JavaScript. For our goal we’re going to use only HTML5 and JavaScript (client and server side). The end result will be something like this:So, let’s begin!Our application will have very simple architecture – a proxy server written in Node.js and a client in HTML5 and JavaScript. The Node.">


<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id":"http://blog.mgechev.com/"
    },
    "headline": "VNC client on 200 lines of JavaScript - Minko Gechev&#39;s blog",
    "datePublished": "2013-08-30T00:00:00JST",
    "dateModified": "2013-08-30T00:00:00JST",
    "author": {
      "@type": "Person",
      "name": "Minko Gechev&#39;s blog"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Minko Gechev&#39;s blog",
      "logo": {
        "@type": "ImageObject",
        "url": "http://blog.mgechev.com/images/logo.png",
        "width": 600,
        "height": 60
      }
    },
    "description": "In this quick blog post I’ll show you how to create a simple VNC client in about 200 lines of JavaScript. For our goal we’re going to use only HTML5 and JavaScript (client and server side). The end result will be something like this:

So, let’s begin!
Our application will have very simple architecture – a proxy server written in Node.js and a client in HTML5 and JavaScript. The Node."
  }
</script>


    <style amp-custom="">
      html { font-size: 18px;}@media (max-width: 768px) { html { font-size: 15px; }}body { font-family: Lato,'Hiragino Kaku Gothic Pro',メイリオ,Meiryo,sans-serif; font-size: inherit; margin: 0; color: #263238;}html, body { margin: 0;}a { text-decoration: none; color: #e91e63;}p { margin: 0;}ul,ol { margin: 0; padding: 0;}h1, h2, h3, h4, h5, h6 { margin: 0; font-weight: 700;}h1 { font-size: 1.8rem; line-height: 2rem; margin: 1.5rem 0; }h2 { font-size: 1.4rem; line-height: 2rem; margin: 1.5rem 0; }h3 { font-size: 1.2rem; line-height: 1.5rem; margin: 1.5rem 0; }h4, h5, h6 { font-size: 1rem; line-height: 1.5rem; margin: 1.5rem 0; }.clearfix::after { content: ''; display: block; clear: both;}main { display: block;}/* Layouts */.l-header { padding: .5rem 0; margin-bottom: 2rem; border-bottom: 1px dashed #cfd8dc; text-align: center;}.l-footer { font-size: .8rem; padding: 1rem 0; border-top: 1px dashed #cfd8dc;}.l-container { max-width: 42rem; margin: 0 auto; padding: 0 1rem;}/* Parts:logo */.p-logo { font-family: Lobster, cursive;}.p-logo a { color: #000; font-size: 1.6rem; line-height: 2rem;}/* Parts:section */section { border-top: 2px solid #eceff1; padding: 1.5rem 0;}section>header { text-transform: uppercase; font-weight: 700; margin-bottom: 2rem; text-align: center;}section>header span { display: inline-block; background-color: #000; color: #fff; letter-spacing: 3px; font-size: .7rem; padding: .5rem .75rem;}/* Parts:facts */.p-facts { list-style: none; font-size: .8rem; margin-bottom: 1rem;}.p-facts:last-child { margin-bottom: 0;}.p-facts li { display: inline-block; margin-right: .5rem; text-transform: uppercase;}.p-facts li header { margin-bottom: .25rem; font-weight: 700;}.p-facts li header a { color: #000; text-decoration: underline;}.p-facts li li { display: inline-block; margin-right: .5rem;}.p-facts li li::after { content: ',';}.p-facts li li:last-child::after { content: '';}/* Parts:crumb */.p-crumb { list-style: none; margin-bottom: 1rem; font-size: .8rem; text-transform: uppercase; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}.p-crumb:last-child { margin-bottom: 0;}.p-crumb li { display: inline;}.p-crumb li::after { content: '›'; margin: 0 .5rem;}.p-crumb li:last-child::after { content: '';}/* Parts:page-title */.p-page-title { margin-bottom: 2rem;}.p-page-title .title { margin-bottom: .5rem;}/* Parts:share */.p-share { margin-bottom: 1.5rem;}.p-share a { display: inline-block; text-align: center; padding: .5rem .5rem; margin-right: .25rem; font-size: .6rem; background-color: #eceff1; font-weight: 700k}.p-share a.ht { color: #00a4de; }.p-share a.fb { color: #3b5998; }.p-share a.tw { color: #1da1f2; }.p-share a.gp { color: #dd4b39; }.p-share a.ln { color: #00c300; }.p-share a.ht::before { content: 'Hatena'; }.p-share a.fb::before { content: 'Facebook'; }.p-share a.tw::before { content: 'Twitter'; }.p-share a.gp::before { content: 'Google+'; }.p-share a.ln::before { content: 'LINE'; }/* Parts:terms */.p-terms { padding-left: 2rem;}/* Parts:paginator */.p-paginator { text-align: center; margin-bottom: 3rem; padding-top: 2rem;}.p-paginator a { display: inline-block; border: 2px solid #eceff1; color: #263238; line-height: 2rem; padding: 0 1rem;}/* Parts:article */.p-articles { list-style: none;}.p-articles>li { margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px dashed #cfd8dc;}.p-articles>li:last-child { border-bottom: none; padding-bottom: 0;}.p-articles.thin>li { margin-bottom: 1rem; padding-bottom: 1rem;}article .article-header { display: table-cell; height: 6rem; vertical-align: middle;}article .title { margin: 0; margin-bottom: .5rem; font-size: 1.4rem; line-height: 2rem;}article .title a { color: #000;}article .header-wrapper { margin-bottom: 1.5rem;}article .thumbnail { display: none;}article .summary { margin-bottom: 1.5rem;}article .readmore { text-align: center;}article .readmore a { font-size: .8rem; color: #000; text-decoration: underline;}article.li.sm .header-wrapper { margin-bottom: 0;}.article-body h2 { padding: 1rem 0; border-bottom: 2px solid #eceff1;}.article-body h2:first-child { margin-top: 0; }.article-body h3 { color: #cddc39;}.article-body h4 { border-left: solid .25rem #cddc39; padding: 0 .5rem;}.article-body p { margin: 1.5rem 0; line-height: 1.5rem;}.article-body a { text-decoration: underline;}.article-body ul,.article-body ol { padding-left: 1.5rem;}.article-body code { display: inline-block; font-family: Menlo, consolas, monospace; background-color: #eceff1; font-size: .8rem; padding: 0 .5rem; line-height: 1.5rem;}.article-body pre { margin: 1.5rem 0; padding: 1.5rem; font-size: .8rem; background-color: #263238; color: #fff; overflow: auto;}.article-body pre code { background-color: transparent;}.article-body blockquote { margin: 1.5rem 0; padding: .5rem 0; font-size: .8rem; border-top: 1px solid #eceff1; border-bottom: 1px solid #eceff1; color: #607d8b;}.article-body blockquote p { margin: .5rem 0; line-height: 1rem;}.article-body strong { box-shadow: 0 -.5rem 0 0 #f06292 inset;}.article-body em { font-style: normal; font-weight: 700; color: #ff5722;}.article-body figure { margin: 1.5rem -2rem; }.article-body figure.left,.article-body figure.right { width: 15rem; height: 12rem; margin-top: 0; margin-left: 0; margin-right: 0;}.article-body figure.left { float: left; margin-right: 1rem; margin-left: -2rem; }.article-body figure.right { float: right; margin-left: 1rem; margin-right: -2rem; }@media (max-width: 768px) { .article-body figure { margin: 1.5rem -1rem; } .article-body figure.left, .article-body figure.right { float: none; margin: 0 -1rem; width: auto; height: auto; }}.article-body figcaption { padding: .5rem 0; font-size: .8rem; text-align: center;}.article-body figcaption a { color: #263238;}img { max-width: 100%;}

      
    </style>
  </head>

  <body>
    
    
    <amp-analytics type="googleanalytics" id="analytics1">
      <script type="application/json">
        {
          "vars": {
            "account": "UA-18060688-3"
          },
          "triggers": {
            "trackPageview": {
              "on": "visible",
              "request": "pageview"
            }
          }
        }
      </script>
    </amp-analytics>
    
    

    <header class="l-header">
      <div class="l-container">
        <div class="h-logo p-logo">
          <a href="http://blog.mgechev.com/" class="h-logo">Minko Gechev&#39;s blog</a>
        </div>
      </div>
    </header>

    <main>
      
<div class="l-container">
  <article class="single article-5627f4dbb642c2d43d6ec7b66685921a">
  <div class="header-wrapper">
    <a href="http://blog.mgechev.com/2013/08/30/vnc-javascript-nodejs/" class="thumbnail" title="VNC client on 200 lines of JavaScript"></a>
    <header class="article-header">
      <div class="clearfix">
        <h1 class="title">VNC client on 200 lines of JavaScript</h1>
        <ul class="p-facts">
          <li><time datetime="2013-08-30T00:00:00JST">Aug 30, 2013</time></li>
          <li><a href="http://blog.mgechev.com/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>

  <aside class="p-share">
  <a href="http://www.facebook.com/sharer.php?u=http%3a%2f%2fblog.mgechev.com%2f2013%2f08%2f30%2fvnc-javascript-nodejs%2f&t=VNC%20client%20on%20200%20lines%20of%20JavaScript" title="Facebookでシェア" class="fb" target="_blank" rel="nofollow"></a>
  <a href="http://twitter.com/intent/tweet?url=http%3a%2f%2fblog.mgechev.com%2f2013%2f08%2f30%2fvnc-javascript-nodejs%2f&text=VNC%20client%20on%20200%20lines%20of%20JavaScript&tw_p=tweetbutton" title="Twitterでシェア" class="tw" target="_blank" rel="nofollow"></a>
  <a href="https://plus.google.com/share?url=http%3a%2f%2fblog.mgechev.com%2f2013%2f08%2f30%2fvnc-javascript-nodejs%2f" title="Google Plusでシェア" class="gp" target="_blank" rel="nofollow"></a>
</aside>


  <div class="article-body"><p>In this quick blog post I’ll show you how to create a simple VNC client in about 200 lines of JavaScript.
For our goal we’re going to use only HTML5 and JavaScript (client and server side).
The end result will be something like this:</p>

<p><a href="/images/legacy/uploads2013/08/js-vnc.png"><amp-img src="/images/legacy/uploads2013/08/js-vnc-1024x946.png" alt="js-vnc" width="600" height="554" class="alignnone size-large wp-image-500" layout="responsive"></amp-img></a></p>

<p>So, let’s begin!</p>

<p>Our application will have very simple architecture – a proxy server written in Node.js and a client in HTML5 and JavaScript. The Node.js server will stay between the browser and the VNC server. We need it because the client-side JavaScript does not supports TCP sockets so we can’t connect directly to the VNC server. The HTML5 client will have a canvas on which we will draw the frames we receive from the server.
For VNC server you can use the free version of <a href="http://www.realvnc.com/">RealVNC</a>.</p>

<p>First lets start with the server. Make sure you have node.js installed. We will use four node modules: <a href="https://github.com/sidorares/node-rfb2">rfb2</a>, <a href="https://npmjs.org/package/connect">connect</a>, <a href="http://socket.io/">socket.io</a> and <a href="https://github.com/pkrumins/node-png">node-png</a>.</p>

<p>Enter the following commands in your terminal:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="nb">cd</span> ~
mkdir js-vnc
<span class="nb">cd</span> js-vnc
npm init
</code></pre></div>


<p>Now you should have folder called “js-vnc” with file named “package.json” in it.
Use the following line of code to install almost all the dependencies:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>npm install rfb2 connect socket.io --save
</code></pre></div>


<p>Unfortunately node-png is not in the npm registry and we have to build it from source.
Use:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>sudo npm install -g node-gyp
<span class="nb">cd</span> node_modules
git clone git@github.com:pkrumins/node-png.git
<span class="nb">cd</span> node-png
node-gyp configure build
</code></pre></div>


<p>and that was all&hellip;Now we can start creating our server.
Let’s include all the required modules and initialize an array which will contains all the connected clients. Create a file called “server.js” in your project base directory and add the following content in it:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kd">var</span> <span class="nx">rfb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;rfb2&#39;</span><span class="p">),</span>
    <span class="nx">socketio</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io&#39;</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8091</span><span class="p">,</span> <span class="p">{</span> <span class="nx">log</span><span class="o">:</span> <span class="kc">false</span> <span class="p">}),</span>
    <span class="nx">Png</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./node_modules/node-png/build/Release/png&#39;</span><span class="p">).</span><span class="nx">Png</span><span class="p">,</span>
    <span class="nx">connect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">),</span>
    <span class="nx">clients</span> <span class="o">=</span> <span class="p">[];</span>
</code></pre></div>


<p>and now let’s create a static directory for our static resources:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>mkdir static
</code></pre></div>


<p>now we can set the static directory of the connect server:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>//creating new HTTP server. It will serve static files from the directory <span class="s2">&quot;./static&quot;</span> and will listen on <span class="m">8090</span> port
connect.createServer<span class="o">(</span>connect.static<span class="o">(</span><span class="s1">&#39;./static&#39;</span><span class="o">))</span>.listen<span class="o">(</span><span class="m">8090</span><span class="o">)</span><span class="p">;</span>
</code></pre></div>


<p>Now you can execute the following lines of code:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="nb">echo</span> <span class="s2">&quot;Hello, world!&quot;</span> &gt; ./static/index.html
node server.js
</code></pre></div>


<p>Now open: <a href="http://localhost:8091/index.html">http://localhost:8091/index.html</a>. If everything went well you should see the text: “Hello, world!”.</p>

<p>So far, so good! Now lets create a socket.io server.
We want the client to connect to our proxy server and exchange data through socket.io with it. When the client is connected (i.e. the connection is established) it sends “init” message which contains the data required for the proxy server to connect to the VNC server – host, port and password.
So let’s handle these events:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">socketio</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">createRfbConnection</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">socket</span><span class="p">);</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mouse&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">evnt</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">pointerEvent</span><span class="p">(</span><span class="nx">evnt</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">evnt</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">evnt</span><span class="p">.</span><span class="nx">button</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;keyboard&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">evnt</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">keyEvent</span><span class="p">(</span><span class="nx">evnt</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">,</span> <span class="nx">evnt</span><span class="p">.</span><span class="nx">isDown</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;disconnect&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">disconnectClient</span><span class="p">(</span><span class="nx">socket</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>


<p>We already listen for incoming connections with socket.io on port 8091 so now we just subscribe to the “connection” event. When the client connects to our socket.io server we subscribe the server to the “init” event. It’s the message I told about earlier. Its parameters will contains data required for the proxy server to connect to the VNC server. In the callback associated with the “init” event we first create new RFB (remote framebuffer) connection. This method will return a RFB handler, we can use it to exchange data with the VNC server. After initialising the RFB connection we subscribe to three more events: “mouse”, “keyboard” and “disconnect”. The mouse event has parameter containing the position of the cursor and button state (1 for mouse down 0 for mouse up). For this demo we will support only the first mouse button. The keyboard event accepts as parameters the key code of the button which have triggered the event and flag which indicates whether the button is down or up. When the disconnect event happens we disconnect from the VNC server and release all the data for the current connection.</p>

<p>Here is posted the function createRfbConnection:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kd">function</span> <span class="nx">createRfbConnection</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">rfb</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
    <span class="nx">host</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">host</span><span class="p">,</span>
    <span class="nx">port</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">password</span>
  <span class="p">});</span>
  <span class="nx">addEventHandlers</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">socket</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>


<p>In the method “addEventHandlers” we add event handlers to the RFB handler we received from the “createConnection” method:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kd">function</span> <span class="nx">addEventHandlers</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">width</span><span class="o">:</span> <span class="nx">r</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
      <span class="nx">height</span><span class="o">:</span> <span class="nx">r</span><span class="p">.</span><span class="nx">height</span>
    <span class="p">});</span>
    <span class="nx">clients</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="nx">socket</span><span class="o">:</span> <span class="nx">socket</span><span class="p">,</span>
      <span class="nx">rfb</span><span class="o">:</span> <span class="nx">r</span>
    <span class="p">});</span>
  <span class="p">});</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;rect&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rect</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">handleFrame</span><span class="p">(</span><span class="nx">socket</span><span class="p">,</span> <span class="nx">rect</span><span class="p">,</span> <span class="nx">r</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>


<p>When the RFB connection is established we send “init” event to the client (our browser) with the size of the screen. For simplicity we won’t scale the screen in the browser.
After sending the “init” event to the browser we add the client to our connected clients and subscribe to the event “rect”. The “rect” event will trigger when there is a screen update. For extra simplicity we will use raw encoding.</p>

<p>The last method from our Node.js proxy we will look at is the “handleFrame” method.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kd">function</span> <span class="nx">handleFrame</span><span class="p">(</span><span class="nx">socket</span><span class="p">,</span> <span class="nx">rect</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">rgb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;binary&#39;</span><span class="p">),</span>
    <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">rgb</span><span class="p">[</span><span class="nx">offset</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
    <span class="nx">rgb</span><span class="p">[</span><span class="nx">offset</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="nx">rgb</span><span class="p">[</span><span class="nx">offset</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">image</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Png</span><span class="p">(</span><span class="nx">rgb</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="s1">&#39;rgb&#39;</span><span class="p">);</span>
  <span class="nx">image</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">encodeSync</span><span class="p">();</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;frame&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">x</span><span class="o">:</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
    <span class="nx">y</span><span class="o">:</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
    <span class="nx">width</span><span class="o">:</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
    <span class="nx">height</span><span class="o">:</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span>
    <span class="nx">image</span><span class="o">:</span> <span class="nx">image</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">&#39;base64&#39;</span><span class="p">)</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>


<p>We create new binary buffer with size &ldquo;rect.width * rect.height * 3&rdquo; and process the received pixmap. After that we create new PNG image from it by specifying its width, height and format (rgb). We encode the image and emit the event &ldquo;frame&rdquo; with parameters the coordinates of the image, its size and the actual image in base64 format.</p>

<p>And we&rsquo;re done with our server! There&rsquo;s one detail which I missed with purpose. In this version we don&rsquo;t use all the advantages of the RFB protocol. It has incremental frame transmitting which I&rsquo;ve omitted. RFB implementation with excluded incremental transmission can be downloaded from <a href="https://github.com/mgechev/node-rfb2">here</a>.</p>

<p>And now our simple client!</p>

<p>Edit the content of the file ./static/index.html with the following content:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;./css/bootstrap.min.css&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;./css/styles.css&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-wrapper&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;form-wrapper&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-horizontal&quot;</span> <span class="na">onsubmit</span><span class="o">=</span><span class="s">&quot;return false&quot;</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;control-group&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;control-label&quot;</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;host&quot;</span><span class="p">&gt;</span>Host:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;controls&quot;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;host&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;host&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;192.168.100.6&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;control-group&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;control-label&quot;</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;port&quot;</span><span class="p">&gt;</span>Port:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;controls&quot;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;port&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;port&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;5900&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;control-group&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;control-label&quot;</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;port&quot;</span><span class="p">&gt;</span>Port:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;controls&quot;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;paralaks&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;control-group&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;controls&quot;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;loginBtn&quot;</span><span class="p">&gt;</span>Log in<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">canvas</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;screen&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">canvas</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;http://localhost:8091/socket.io/socket.io.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;./js/Client.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>


<p>We&rsquo;ve added simple bootstrap form and a canvas. Now create sub-directory of our project base directory: &ldquo;./static/js&rdquo; and create the file &ldquo;Client.js&rdquo; in it.</p>

<p>We will wrap the whole code in an IIFE to omit any globals. Let&rsquo;s create a simple object which will hold our settings:</p>

<p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">Config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">URL</span><span class="o">:</span> <span class="s1">&#39;http://localhost:8091&#39;</span>
  <span class="p">};</span>
  <span class="c1">//..more code here</span>
<span class="p">}());</span>
</code></pre></div>
</p>

<p>Now lets add some code for initialisation after the &ldquo;Config&rdquo; declaration:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;loginBtn&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">screen</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Screen</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;screen&#39;</span><span class="p">)),</span>
      <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">(</span><span class="nx">screen</span><span class="p">);</span>

    <span class="nx">client</span><span class="p">.</span><span class="nx">connect</span><span class="p">({</span>
      <span class="nx">host</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">,</span>
      <span class="nx">port</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
      <span class="nx">password</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">,</span>
      <span class="nx">callback</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;form-wrapper&#39;</span><span class="p">).</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;form-wrapper-hidden&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</code></pre></div>


<p>We simply add event handler on click of the button with id &ldquo;loginBtn&rdquo;. In the callback we initialise new &ldquo;Screen&rdquo; object with our canvas as argument of the constructor function and create new &ldquo;Client&rdquo; with the Screen object as parameter. We call the connect method of the client with the specified parameters - host, port, password and a callback which will be invoked when the client is being connected.</p>

<p>This is the definition of the connect method:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">Client</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">connect</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">Config</span><span class="p">.</span><span class="nx">URL</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">host</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">host</span><span class="p">,</span>
      <span class="nx">port</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span>
      <span class="nx">password</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">password</span>
    <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_addHandlers</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">callback</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_initEventListeners</span><span class="p">();</span>
  <span class="p">};</span>
</code></pre></div>


<p>It creates new socket.io connection with the server&rsquo;s socket.io server host name and port and emits the &ldquo;init&rdquo; event we already talked about (contains data required for connection to the VNC server). After that we add handlers which will listen for events coming from the server - the &ldquo;init&rdquo; and &ldquo;rect&rdquo; event. Since the &ldquo;rect&rdquo; event is a bit more interesting we will look in its handling:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="k">this</span><span class="p">.</span><span class="nx">_socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;frame&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">frame</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">that</span><span class="p">.</span><span class="nx">_screen</span><span class="p">.</span><span class="nx">drawRect</span><span class="p">(</span><span class="nx">frame</span><span class="p">);</span>
  <span class="p">});</span>
</code></pre></div>


<p>As you see we simply delegate the drawing to the screen and pass it the frame as argument.
And here is the actual drawing on the canvas:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">Screen</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">drawRect</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rect</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">img</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">(),</span>
      <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">img</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="nx">img</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
    <span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s1">&#39;data:image/png;base64,&#39;</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">image</span><span class="p">;</span>
    <span class="nx">img</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">that</span><span class="p">.</span><span class="nx">_context</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">};</span>
</code></pre></div>


<p>We create new image with the frame&rsquo;s width and height as dimensions and we set image&rsquo;s src to be equal to the frame&rsquo;s base64 image. After that, when the image is loaded we draw it onto the canvas.</p>

<p>The last interesting moment is the handling of the mouse and keyboard events.
Of course we delegate it to the screen object:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">Client</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_initEventListeners</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_screen</span><span class="p">.</span><span class="nx">addMouseHandler</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">button</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">_socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;mouse&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">x</span><span class="o">:</span> <span class="nx">x</span><span class="p">,</span>
        <span class="nx">y</span><span class="o">:</span> <span class="nx">y</span><span class="p">,</span>
        <span class="nx">button</span><span class="o">:</span> <span class="nx">button</span>
      <span class="p">});</span>
    <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_screen</span><span class="p">.</span><span class="nx">addKeyboardHandlers</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">isDown</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">_socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;keyboard&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">keyCode</span><span class="o">:</span> <span class="nx">code</span><span class="p">,</span>
        <span class="nx">isDown</span><span class="o">:</span> <span class="nx">isDown</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">};</span>
</code></pre></div>


<p>As you see we add the mouse and keyboard event handlers and in the event callbacks we simply emit new socket.io events, respectively: &ldquo;mouse&rdquo; and &ldquo;keyboard&rdquo;, with their arguments. For simplicity our canvas is absolutely positioned and has coordinates (0, 0).</p>

<p>And&hellip;well&hellip;thats all! We have ready to go VNC client in just few lines of JavaScript!</p>

<p><span>The <strong><a href="https://github.com/mgechev/js-vnc-demo-project">source code</a></strong> from this article can be found in my <a href="https://github.com/mgechev/js-vnc-demo-project">GitHub account</a></span>.</p>

<p>Quick video demo</p>
</div>

  <aside class="p-share">
  <a href="http://www.facebook.com/sharer.php?u=http%3a%2f%2fblog.mgechev.com%2f2013%2f08%2f30%2fvnc-javascript-nodejs%2f&t=VNC%20client%20on%20200%20lines%20of%20JavaScript" title="Facebookでシェア" class="fb" target="_blank" rel="nofollow"></a>
  <a href="http://twitter.com/intent/tweet?url=http%3a%2f%2fblog.mgechev.com%2f2013%2f08%2f30%2fvnc-javascript-nodejs%2f&text=VNC%20client%20on%20200%20lines%20of%20JavaScript&tw_p=tweetbutton" title="Twitterでシェア" class="tw" target="_blank" rel="nofollow"></a>
  <a href="https://plus.google.com/share?url=http%3a%2f%2fblog.mgechev.com%2f2013%2f08%2f30%2fvnc-javascript-nodejs%2f" title="Google Plusでシェア" class="gp" target="_blank" rel="nofollow"></a>
</aside>


  <footer class="article-footer">
    <section>
      <ol class="p-crumb">
        <li><a href="http://blog.mgechev.com/">Minko Gechev&#39;s blog</a></li>
        
        <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="http://blog.mgechev.com/post/" itemprop="url"><span itemprop="title">post</span></a></li>
        
        <li>VNC client on 200 lines of JavaScript</li>
      </ol>

      
      
      
      <ul class="p-facts">
        <li>
          <header><a href="http://blog.mgechev.com/categories/">categories</a></header>
          <ul>
            
            <li><a href="http://blog.mgechev.com/categories/Browsers/">Browsers</a></li>
            
            <li><a href="http://blog.mgechev.com/categories/Canvas/">Canvas</a></li>
            
            <li><a href="http://blog.mgechev.com/categories/Computer-science/">Computer science</a></li>
            
            <li><a href="http://blog.mgechev.com/categories/CSS3/">CSS3</a></li>
            
            <li><a href="http://blog.mgechev.com/categories/Development/">Development</a></li>
            
            <li><a href="http://blog.mgechev.com/categories/HTML5/">HTML5</a></li>
            
            <li><a href="http://blog.mgechev.com/categories/Immediately-Invoked-Function-Expression/">Immediately Invoked Function Expression</a></li>
            
            <li><a href="http://blog.mgechev.com/categories/JavaScript/">JavaScript</a></li>
            
            <li><a href="http://blog.mgechev.com/categories/Node.js/">Node.js</a></li>
            
            <li><a href="http://blog.mgechev.com/categories/OpenSource/">OpenSource</a></li>
            
            <li><a href="http://blog.mgechev.com/categories/Programming/">Programming</a></li>
            
            <li><a href="http://blog.mgechev.com/categories/VNC/">VNC</a></li>
            
          </ul>
        </li>
      </ul>
      
      
      
      <ul class="p-facts">
        <li>
          <header><a href="http://blog.mgechev.com/tags/">tags</a></header>
          <ul>
            
            <li><a href="http://blog.mgechev.com/tags/Computer-science/">Computer science</a></li>
            
            <li><a href="http://blog.mgechev.com/tags/Development/">Development</a></li>
            
            <li><a href="http://blog.mgechev.com/tags/HTML5/">HTML5</a></li>
            
            <li><a href="http://blog.mgechev.com/tags/HTTP/">HTTP</a></li>
            
            <li><a href="http://blog.mgechev.com/tags/JavaScript/">JavaScript</a></li>
            
            <li><a href="http://blog.mgechev.com/tags/Node.js/">Node.js</a></li>
            
            <li><a href="http://blog.mgechev.com/tags/OpenSource/">OpenSource</a></li>
            
            <li><a href="http://blog.mgechev.com/tags/vnc/">vnc</a></li>
            
          </ul>
        </li>
      </ul>
      
      
    </section>
  </footer>
</article>



  
  
  <section>
    <header><span>Latests</span></header>
    <ul class="p-articles thin">
      <li><article class="li sm article-65b7794818635a71066d583c1d19dfcf">
  <div class="header-wrapper">
    <a href="http://blog.mgechev.com/2018/03/18/machine-learning-data-driven-bundling-webpack-javascript-markov-chain-angular-react/" class="thumbnail" title="Machine Learning-Driven Bundling. The Future of JavaScript Tooling."></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="http://blog.mgechev.com/2018/03/18/machine-learning-data-driven-bundling-webpack-javascript-markov-chain-angular-react/">Machine Learning-Driven Bundling. The Future of JavaScript Tooling.</a></h2>
        <ul class="p-facts">
          <li><time datetime="2018-03-18T00:00:00JST">Mar 18, 2018</time></li>
          <li><a href="http://blog.mgechev.com/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li><li><article class="li sm article-1ba3d07ae77c655266ce0f1522db4da3">
  <div class="header-wrapper">
    <a href="http://blog.mgechev.com/2018/01/29/javascript-decorators-aop-autobind-memoization/" class="thumbnail" title="JavaScript Decorators for Declarative and Readable Code"></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="http://blog.mgechev.com/2018/01/29/javascript-decorators-aop-autobind-memoization/">JavaScript Decorators for Declarative and Readable Code</a></h2>
        <ul class="p-facts">
          <li><time datetime="2018-01-29T00:00:00JST">Jan 29, 2018</time></li>
          <li><a href="http://blog.mgechev.com/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li><li><article class="li sm article-43672564696ee352fbf3cd0b906f1e8b">
  <div class="header-wrapper">
    <a href="http://blog.mgechev.com/2018/01/18/react-typescript-redux-immutable/" class="thumbnail" title="3 Tricks For Using Redux and Immutable.js with TypeScript"></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="http://blog.mgechev.com/2018/01/18/react-typescript-redux-immutable/">3 Tricks For Using Redux and Immutable.js with TypeScript</a></h2>
        <ul class="p-facts">
          <li><time datetime="2018-01-18T00:00:00JST">Jan 18, 2018</time></li>
          <li><a href="http://blog.mgechev.com/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li>
    </ul>
  </section>
  
</div>


    </main>

    

    <footer class="l-footer">
      <div class="l-container">
        <p><span class="h-logo">&copy; Minko Gechev&#39;s blog</span></p>
      </div>
    </footer>

    <a href="#" class="p-movetop" title="ページ上部へ戻る" rel="nofollow"></a>
  </body>
</html>

